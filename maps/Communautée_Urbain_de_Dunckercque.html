<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Carte des Bâtiments – la CUD</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>#map{width:100%;height:100vh;margin:0;padding:0}</style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([51.022146, 2.348398], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    fetch('buildings.geojson')
      .then(r=>r.json())
      .then(data=>{
        L.geoJSON(data, {
          style: f=>({
            fillColor: f.properties.color,
            color: f.properties.color,
            weight: 1,
            fillOpacity: 0.7
          }),
          onEachFeature:(feature,layer)=>{
            const p = feature.properties;
            layer.bindPopup(`
              <strong>Adresse :</strong> ${p.Adresse}<br>
              <strong>Consommation annuelle :</strong> ${(p["Consommation annuelle (en MWh/an)"] || 0).toFixed(2)} MWh/an<br>
              <strong>Consommation par m² :</strong> ${(p["Consommation par m² par an (en kWh/m².an)"] || 0).toFixed(2)} kWh/m².an<br>
              <!--<strong>DLE élec :</strong> ${p.consommation_dle_elec} MWh/an<br>-->
              <!--<strong>DLE gaz :</strong> ${p.consommation_dle_gaz} MWh/an<br>-->
              <!--<strong>DLE réseaux :</strong> ${p.consommation_dle_reseaux} MWh/an<br>-->>
              <strong>Usage :</strong> ${p.UseType}
            `);
          }
        }).addTo(map);
      })
      .catch(e=>console.error('Erreur chargement GeoJSON', e));
    fetch('iris.json')
      .then(r => r.json())
      .then(data => {
      L.geoJSON(data, {
        style: {
          color: '#000000', // contour noir
          weight: 2,
          fillOpacity: 0 // transparent à l intérieur
        },
        onEachFeature: (feature, layer) => {
          const nom = feature.properties.nom || feature.properties.NOM_IRIS || 'IRIS';
          layer.bindPopup(`<strong>IRIS :</strong> ${nom}`);
        }
      }).addTo(map);
    })
    .catch(e => console.error('Erreur chargement IRIS', e));
  </script>
</body>
</html>
